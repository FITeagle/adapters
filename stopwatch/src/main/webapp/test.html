<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">

<script src="jquery-2.1.1.js" type="text/javascript"></script>

<script language="javascript" type="text/javascript">

  var host = "http://localhost:8080/AdapterMotor/api/"

	var wsUri = getRootUri() + "/AdapterMotor/websocket";
	var restOutput;
	var wsOutput;
	var websocket;
	
	var wsSerialization = "ttl";
	var restSerialization = "ttl";

	function getRootUri() {
		return "ws://"
				+ (document.location.hostname == "" ? "localhost"
						: document.location.hostname)
				+ ":"
				+ (document.location.port == "" ? "8080"
						: document.location.port);
	}

	function init() {
		restOutput = document.getElementById("restOutput");
		wsOutput = document.getElementById("wsOutput");

		websocket = new WebSocket(wsUri);
		websocket.onopen = function(evt) {
			onOpen(evt)
		};
		websocket.onmessage = function(evt) {
			onMessage(evt)
		};
		websocket.onerror = function(evt) {
			onError(evt)
		};
	}

	function wsGetDescription() {
		wsDoSend("description." + wsSerialization);
	}
	
	function wsGetInstances() {
		wsDoSend("instances." + wsSerialization);		
	}

	function onOpen(evt) {
		wsWriteToScreen("Connected to Endpoint!");
		// doSend(textID.value);
	}

	function onMessage(evt) {
		wsWriteToScreen("Message Received: " + evt.data);
	}

	function onError(evt) {
		wsWriteToScreen('<span style="color: red;">ERROR:</span> ' + evt.data);
	}

	function wsDoSend(message) {
		wsWriteToScreen("Message Sent: " + message);
		websocket.send(message);
	}

	function wsWriteToScreen(message) {
		var pre = document.createElement("p");
		pre.style.wordWrap = "break-word";
		
//         if(isCommand){
//             pre.style.color = "blue";
//           }

//         if(wsSerialization = "ttl"){
//             message = message.split('\n').join('<br/>');          
//           } else {
//             $('#myText').val(message);
//           }
          pre.innerHTML = message;
          wsOutput.appendChild(pre);
	}
	
	 function restWriteToScreen(isCommand, message) {
		    var pre = document.createElement("p");
		    pre.style.wordWrap = "break-word";
		    if(isCommand){
		    	pre.style.color = "blue";
		    }

// 		    if(restSerialization = "ttl"){
// 		    	message = message.split('\n').join('<br/>');		    	
// 		    } else {
// 		    	alert(getXmlString(message));
// 		    }
		    pre.innerHTML = message;
		    restOutput.appendChild(pre);

		    restOutput.scrollTop = restOutput.scrollHeight;
		  }
	 
	 function getXmlString(xml) {
		  if (window.ActiveXObject) { return xml.xml; }
		  return new XMLSerializer().serializeToString(xml);
		}


	window.addEventListener("load", init, false);

	function restGetDescription() {		
		var restURL = host + "description." + restSerialization;
		restGET(restURL);
	}
	
	 function restGetInstances() {   
		    var restURL = host + "instances." + restSerialization;
		    restGET(restURL);
		  }
	 
	  function restProvisionInstance() {   
		    var restURL = host + "instance/" + $("#restProvisionInstanceNumber").val();
		    restPOST(restURL);
		  }
	  
	  function restMonitorInstance() {   
		  var restURL = host + "instance/" + $("#restMonitorInstanceNumber").val() + "/description." + restSerialization;
		    restGET(restURL);
		  }
	
	  
	   function restTerminateInstance() {   
		      var restURL = host + "instance/" + $("#restTerminateInstanceNumber").val();
		        restDELETE(restURL);
		      }
	  
	  
	  
	function restGET(restURL){
		restWriteToScreen(true, "Sending GET " + restURL);
	    $.ajax({
	        url : restURL,
	        type : 'GET',
	        //data : 'ID=1&Name=John&Age=10', // or $('#myform').serializeArray()
	        success : function(data) {
	          restWriteToScreen(false, data);
	        }
	      });
		
	}
	
	 function restPOST(restURL){
		 restWriteToScreen(true, "Sending POST " + restURL);
	      $.ajax({
	          url : restURL,
	          type : 'POST',
	          //data : 'ID=1&Name=John&Age=10', // or $('#myform').serializeArray()
	          success : function(data) {
	            restWriteToScreen(false, data);
	          }
	        });
	    
	  }
	 
	   function restDELETE(restURL){
		   restWriteToScreen(true, "Sending DELETE " + restURL);
	        $.ajax({
	            url : restURL,
	            type : 'DELETE',
	            //data : 'ID=1&Name=John&Age=10', // or $('#myform').serializeArray()
	            success : function(data) {
	              restWriteToScreen(false, data);
	            }
	          });
	      
	    }
	  
	
	
	
	 function setRestSerialization(fileEnding){
		 restSerialization = fileEnding;
	 }
	 
	   function setWsSerialization(fileEnding){
		   wsSerialization = fileEnding;
		   }
	
</script>


<title>Motor Adapter</title>

</head>
<body style="font: 10px Arial;">

	<div style="width: 45%; padding-right:5%; border-right: 2px solid black; float: left;">

		<h1 style="text-align: center;">
			DM: REST
			</h2>
			<div style="text-align: center;">
				<form action="">

					<input type="radio" name="restSerialization" checked="checked" value="TTL" onclick="setRestSerialization('ttl');"> TTL <input type="radio" name="restSerialization" value="RDF" onclick="setRestSerialization('rdf');"> RDF <input type="radio" name="restSerialization"
						value="NTRIPLE"  onclick="setRestSerialization('ntriple');"> NTRIPLE <br /> <input onclick="restGetDescription()" value="description" type="button"> <input onclick="restGetInstances()"
						value="instances" type="button"><br /> <input onclick="restProvisionInstance()" value="provision" type="button"> ID: <input id="restProvisionInstanceNumber"
						value="1" type="text" size="2">    <input onclick="restMonitorInstance()" value="monitor" type="button"> ID: <input id="restMonitorInstanceNumber"
						value="1" type="text" size="2">   <input onclick="restTerminateInstance()" value="terminate" type="button"> ID: <input id="restTerminateInstanceNumber"
						value="1" type="text" size="2">
				</form>
			</div>
			<div id="restOutput" style="width: 100%; height: 500px; background-color: #DDDDDD; overflow: scroll;"></div>
			
			<textarea id='myText'  rows="30" cols="120" value='123'> </textarea>
	</div>

	<div style="width: 45%; float: right;">

		<h1 style="text-align: center;">
			DM: WebSocket
			</h2>
			<div style="text-align: center;">
				<form action="">

					<input type="radio" name="wsSerialization" checked="checked" value="TTL" onclick="setWsSerialization('ttl');"> TTL <input type="radio" name="wsSerialization" value="RDF" onclick="setWsSerialization('rdf');"> RDF <input type="radio" name="wsSerialization"
						value="NTRIPLE"  onclick="setWsSerialization('ntriple');"> NTRIPLE <br /> <input onclick="wsGetDescription()" value="description" type="button"> <input onclick="wsGetInstances()" value="instances"
						type="button"><br /> <input onclick="wsProvisionInstance()" value="provision" type="button"> ID: <input id="wsProvisionInstanceNumber" value="1" type="text"
						size="3"><input onclick="wsMonitorInstance()" value="monitor" type="button"> ID: <input id="wsMonitorInstanceNumber" value="1" type="text" size="3">
					<input onclick="wsTerminateInstance()" value="terminate" type="button"> ID: <input id="wsTerminateInstanceNumber" value="1" type="text" size="3">
				</form>
			</div>
			<div id="wsOutput" style="width: 100%; height: 500px; background-color: #DDDDDD; overflow: scroll;"></div>
	</div>




</body>
</html>
